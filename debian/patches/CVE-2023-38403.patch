From: Markus Koschany <apo@debian.org>
Date: Thu, 27 Jul 2023 11:23:24 +0200
Subject: CVE-2023-38403

Bug-Debian: https://bugs.debian.org/1040830
Origin: https://github.com/esnet/iperf/commit/0ef151550d96cc4460f98832df84b4a1e87c65e9
---
 src/iperf_api.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/iperf_api.c b/src/iperf_api.c
index 75ff419..09f6dab 100644
--- a/src/iperf_api.c
+++ b/src/iperf_api.c
@@ -1451,12 +1451,15 @@ static cJSON *
 JSON_read(int fd)
 {
     uint32_t hsize, nsize;
+    size_t strsize;
     char *str;
     cJSON *json = NULL;
 
     if (Nread(fd, (char*) &nsize, sizeof(nsize), Ptcp) >= 0) {
 	hsize = ntohl(nsize);
-	str = (char *) malloc(hsize+1);	/* +1 for EOS */
+	strsize = hsize + 1;              /* +1 for trailing NULL */
+	if (strsize) {
+	str = (char *) calloc(sizeof(char), strsize);
 	if (str != NULL) {
 	    if (Nread(fd, str, hsize, Ptcp) >= 0) {
 		str[hsize] = '\0';	/* add the EOS */
@@ -1464,6 +1467,10 @@ JSON_read(int fd)
 	    }
 	}
 	free(str);
+	}
+	else {
+	    printf("WARNING:  Data length overflow\n");
+	}
     }
     return json;
 }
